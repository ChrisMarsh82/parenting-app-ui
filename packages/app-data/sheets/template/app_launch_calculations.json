{
  "flow_type": "template",
  "flow_name": "app_launch_calculations",
  "status": "released",
  "process_on_start": 2,
  "rows": [
    {
      "name": "now",
      "value": "@calc(timestamp())",
      "_translations": {
        "value": {}
      },
      "exclude_from_translation": true
    },
    {
      "type": "display_group",
      "name": "first_launch",
      "condition": "!@fields.app_last_launch",
      "rows": [
        {
          "name": "local_app_launch_count",
          "value": 0,
          "exclude_from_translation": true
        }
      ]
    },
    {
      "type": "display_group",
      "name": "not_first_launch",
      "condition": "@fields.app_last_launch",
      "rows": [
        {
          "name": "days_since_last_app_launch",
          "value": "@calc(window.date_fns.differenceInDays(new Date(@local.now),new Date(@fields.app_last_launch)))",
          "_translations": {
            "value": {}
          },
          "exclude_from_translation": true
        },
        {
          "name": "local_app_launch_count",
          "value": "+@fields.app_launch_count",
          "_translations": {
            "value": {}
          },
          "exclude_from_translation": true
        },
        {
          "name": "local_max_days_between_app_launches",
          "value": "@local.days_since_last_app_launch",
          "_translations": {
            "value": {}
          },
          "condition": "!@fields.max_days_between_app_launches",
          "exclude_from_translation": true
        },
        {
          "type": "display_group",
          "name": "update_maximum",
          "condition": "@fields.max_days_between_app_launches",
          "rows": [
            {
              "name": "previous_max",
              "value": "+@fields.max_days_between_app_launches",
              "_translations": {
                "value": {}
              },
              "exclude_from_translation": true
            },
            {
              "name": "local_max_days_between_app_launches",
              "value": "@calc(Math.max(@local.days_since_last_app_launch,@local.previous_max))",
              "_translations": {
                "value": {}
              },
              "exclude_from_translation": true
            }
          ]
        },
        {
          "type": "set_field",
          "name": "max_days_between_app_launches",
          "value": "@local.local_max_days_between_app_launches",
          "_translations": {
            "value": {}
          },
          "exclude_from_translation": true
        }
      ]
    },
    {
      "type": "set_field",
      "name": "app_launch_count",
      "value": "@local.local_app_launch_count +1",
      "_translations": {
        "value": {}
      },
      "exclude_from_translation": true
    },
    {
      "type": "set_field",
      "name": "app_last_launch",
      "value": "@local.now",
      "_translations": {
        "value": {}
      },
      "exclude_from_translation": true
    },
    {
      "name": "weekly_app_launch_field",
      "value": "app_launch_count_@fields.workshop_id",
      "_translations": {
        "value": {}
      },
      "exclude_from_translation": true
    },
    {
      "type": "display_group",
      "name": "weekly_count_not_yet_defined",
      "condition": "!(@fields.@local.weekly_app_launch_field)",
      "rows": [
        {
          "name": "weekly_app_launch_count",
          "value": 1,
          "exclude_from_translation": true
        }
      ]
    },
    {
      "type": "display_group",
      "name": "weekly_count_already_defined",
      "condition": "@fields.@local.weekly_app_launch_field",
      "rows": [
        {
          "name": "weekly_app_launch_count",
          "value": "+@fields.@local.weekly_app_launch_field +1",
          "_translations": {
            "value": {}
          },
          "exclude_from_translation": true
        }
      ]
    },
    {
      "type": "set_field",
      "name": "@local.weekly_app_launch_field",
      "value": "@local.weekly_app_launch_count",
      "_translations": {
        "value": {}
      },
      "exclude_from_translation": true
    }
  ],
  "_xlsxPath": "global/campaigns/timing_calculations.xlsx"
}